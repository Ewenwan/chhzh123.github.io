---
layout: post
title: TVM - GEMM优化
tags: [dl, tvm]
---

本文记录如何使用TVM v0.6在CPU上优化GEMM，节选自[TVM官方教程](https://docs.tvm.ai/tutorials/optimize/opt_gemm.html#sphx-glr-tutorials-optimize-opt-gemm-py)。类似地，可参考Vivado HLS优化GEMM的[方法]({% post_url 2020-03-11-vivado-hls %})。

<!--more-->

{% include prism-js.html %}

<!-- https://stackoverflow.com/questions/8988855/include-another-html-file-in-a-html-file -->
<!-- <div id="includedContent">
<script language="javascript">
    var code = $(function(){
      $("#includedContent").load("/files/programs/tvm_gemm_cpu.py");
    });
    document.getElementById("includedContent").innerHTML = code;
    console.log(code);
    console.log(hightlightElement(code));
</script>
</div> -->

<pre data-src="{{ site.baseurl }}/files/programs/tvm_gemm_cpu.py"></pre>

输出结果如下，可以看到numpy的速度（调用Intel MKL）是比裸GEMM实现$O(n^3)$要快很多的。
```
produce C {
  for (x, 0, 1024) {
    for (y, 0, 1024) {
      C[((x*1024) + y)] = 0f
      for (k, 0, 1024) {
        C[((x*1024) + y)] = (C[((x*1024) + y)] + (A[((x*1024) + k)]*B[((k*1024) + y)]))
      }
    }
  }
}

Numpy running time: 0.007840
Baseline: 2.361884
```

